from cliente import Client
from persistencia import gravar_Cliente, carregar_clientes, save_Car, upload_car
from defs import get_cliente_information, listar_clientes, remover_cliente_por_numero, modificar_cliente, get_car_information, listar_car, remove_car_by_number, update_car_info, cliente_status, cahnge_cliente_payment_status, payment, change_car_status
import telebot




FICHEIRO = 'clientes.txt'
FILE = 'carros.txt'


def main():
    lista_clientes = carregar_clientes(FICHEIRO)
    car_list = upload_car(FILE)

    while True:
        print("\nMenu:")
        print('Client Options:' .ljust(35)+ 'Car Options:')
        print("1. Add a new client".ljust(35) + "6. Add a new car")
        print("2. Show client list".ljust(35) + "7. Show car list")
        print("3. Delete client".ljust(35) + "8. Delete car")
        print("4. Change client info".ljust(35) + "9. Update car information")
        print("5. Show payment status".ljust(35) + "11. Car status")
        print("10. PAY\n".rjust(30))
        print("12. Exit".rjust(30))



        choice = input("Choose an option: ")

        #Add a new client
        if choice == "1":

            new_client = get_cliente_information()
            lista_clientes.append(new_client)
            gravar_Cliente(FICHEIRO, lista_clientes)
            print('The cliente wes added to clientes.txt')

        #Show client list
        elif choice == "2":
            lista_clientes = carregar_clientes(FICHEIRO)
            listar_clientes(lista_clientes)

        #Delete cliente
        elif choice == "3":
            lista_clientes = carregar_clientes(FICHEIRO)
            if not lista_clientes:
                print("The client list is empty.")
            else:
                listar_clientes(lista_clientes)
                try:
                    number = int(input("\nEnter the number of the client to delete: "))
                    remover_cliente_por_numero(FICHEIRO, number)
                except ValueError:
                    print("Invalid input. Please enter a valid number.")

        #Change cliente info
        elif choice == "4":
            modificar_cliente(FICHEIRO)

        #Show payment status
        elif choice == "5":
            lista_clientes = carregar_clientes(FICHEIRO)
            cliente_status(lista_clientes)
            while True:
                change_status = input('wanna change?(yes/no):').lower()
                if change_status == 'yes':

                    cahnge_cliente_payment_status()
                    break
                elif change_status == 'no':
                    break
                else:
                    print('Please enter correct word')


        #Add a new car
        elif choice == "6":
                new_car = get_car_information()
                car_list.append(new_car)
                save_Car(FILE, car_list)
                print('\nNew car was added to carros.txt')

        #Show car list
        elif choice == "7":
                car_list = upload_car(FILE)
                if not car_list:
                    print("The list is empty.")
                else:
                    listar_car(car_list)

        #Delete car
        elif choice == "8":
                car_list = upload_car(FILE)
                if not car_list:
                    print("The list is empty.")
                else:
                    listar_car(car_list)
                    try:
                        car_number = int(input("Enter the number of the car to delete: "))
                        remove_car_by_number(FILE, car_number)
                    except ValueError:
                        print("Invalid input. Please enter a valid number.")

        #Update car information
        elif choice == "9":
                car_list = upload_car(FILE)
                if not car_list:
                    print("The list is empty.")
                else:
                    listar_car(car_list)
                    try:
                        car_number = int(input("Enter the number of the car to update: "))
                        if 1 <= car_number <= len(car_list):
                            updated_car = update_car_info(car_list[car_number - 1])
                            car_list[car_number - 1] = updated_car
                            save_Car(FILE, car_list)
                            print(f"\nCar {car_number} was updated successfully.")
                        else:
                            print(f"\nInvalid car number. Please enter a number between 1 and {len(car_list)}.")
                    except ValueError:
                        print("Invalid input. Please enter a valid number.")

        #PAYmant
        elif choice == '10':
            payment()

        #car staus
        elif choice == "11":
            car_list = upload_car(FILE)
            if not car_list:
                print("The list is empty.")
            else:
                change_car_status(FILE)

        #Exit
        elif choice == "12":
            print("Goodbye!")
            break

        else:
            print('Invalid Number, please try again')









if __name__ == "__main__":
    main()
